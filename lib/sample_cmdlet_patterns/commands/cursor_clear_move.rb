# frozen_string_literal: true

require_relative '../command'

require 'tty-config'
require 'tty-prompt'

module SampleCmdletPatterns
  module Commands
    # Text Clearing and Moving - This section provide APIs to modify text buffer contents.
    class CursorClearMove < SampleCmdletPatterns::Command
      def initialize(options)
        @options = options

        @text = <<~TEXT
          0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567
          1**************************************11**************************************11**************************************11**************************************1
          2**************************************22**************************************22**************************************22**************************************2
          3**************************************33**************************************33**************************************33**************************************3
          4**************************************44**************************************44**************************************44**************************************4
          5**************************************55**************************************55**************************************55**************************************5
          6**************************************66**************************************66**************************************66**************************************6
          7**************************************77**************************************77**************************************77**************************************7
          8**************************************88**************************************88**************************************88**************************************8
          9**************************************99**************************************99**************************************99**************************************9
          0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567
          0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567
          1**************************************11**************************************11**************************************11**************************************1
          2**************************************22**************************************22**************************************22**************************************2
          3**************************************33**************************************33**************************************33**************************************3
          4**************************************44**************************************44**************************************44**************************************4
          5**************************************55**************************************55**************************************55**************************************5
          6**************************************66**************************************66**************************************66**************************************6
          7**************************************77**************************************77**************************************77**************************************7
          8**************************************88**************************************88**************************************88**************************************8
          9**************************************99**************************************99**************************************99**************************************9
          0123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567012345670123456701234567
        TEXT
      end

      # Execute CursorClearMove subcommand taking input from
      # a input stream and writing to output stream
      #
      # sample: output.puts 'OK'
      def execute(input: $stdin, output: $stdout)
        cursor = TTY::Cursor
        cursor.clear_screen

        process('Clear screen') { puts cursor.clear_screen }

        process('Clear 11 lines down') { puts cursor.clear_lines(11, :down) }

        process('Move to 1, 13/14 and clear line after') do
          puts cursor.move_to(1, 13)
          puts cursor.clear_line_after
          puts cursor.move_to(1, 14)
          puts cursor.clear_line_after
        end

        process('Move to 1, 15 and clear everything down') do
          puts cursor.move_to(1, 15)
          puts cursor.clear_screen_down
        end

        process('Move to 1, 15 and clear everything up') do
          puts cursor.move_to(1, 15)
          puts cursor.clear_screen_up
        end

        process('Scroll up') do
          prompt.warn @text
          prompt.keypress('', timeout: 2)
          puts cursor.scroll_up
          prompt.error @text
          prompt.keypress('', timeout: 2)
          puts cursor.scroll_up
          prompt.ok @text
          prompt.keypress('', timeout: 2)
          puts cursor.scroll_up
          prompt.warn @text
          prompt.keypress('', timeout: 2)
          puts cursor.scroll_up
          prompt.error @text
          puts cursor.scroll_up
        end

        :gui
      end

      def process(message)
        puts cursor.clear_screen
        prompt.ok @text
        puts cursor.move_to(1, 1)
        prompt.keypress("#{message} in :countdown ...", timeout: 3)
        yield
        puts cursor.move_to(1, 1)
        prompt.keypress('Next :countdown ...', timeout: 3)
      end
    end
  end
end
